<!-- Support Information Card -->
<div class="support-info-card">
    <div class="support-header">
        <!-- Support Title Section -->
        <div class="support-title-section">
            <div class="support-title-row">
                <h2 class="support-title">Support Information</h2>
            </div>
            
            <!-- Progress Bar -->
            <div class="support-progress-section">
                <div class="support-progress-fill"></div>
                <div class="support-progress-remaining"></div>
            </div>
        </div>

        <!-- Support Details Display -->
        <div class="support-details" *ngIf="ticketData?.ticket as ticket">

            <!-- First Row: Close Estimate, Estimate Time, Due Date, Lead Time -->
            <div class="support-row first-row">
                <div class="support-item close-estimate">
                    <div class="support-label">Close Estimate:</div>
                    <div class="support-value">
                        {{ ticket.close_estimate ? formatDateTime(ticket.close_estimate) : '-' }}
                    </div>
                </div>

                <div class="support-divider"></div>

                <div class="support-item estimate-time">
                    <div class="support-label">Estimate time:</div>
                    <div class="support-value">{{ estimateTime }} H</div>
                </div>

                <div class="support-divider"></div>

                <div class="support-item due-date">
                    <div class="support-label">Due date:</div>
                    <div class="support-value">{{ formatDate(ticket.due_date) || '-' }}</div>
                </div>

                <div class="support-divider"></div>

                <div class="support-item lead-time">
                    <div class="support-label">Lead Time:</div>
                    <div class="support-value">{{ leadTime }} H</div>
                </div>
            </div>

            <!-- Second Row: Assignee, Related Tickets -->
            <div class="support-row second-row">
                <div class="support-item assignee">
                    <div class="support-label">Assignee / Support Team:</div>
                    <div class="support-value">{{ assignToName }}</div>
                </div>

                <div class="support-divider"></div>

                <div class="support-item related-tickets">
                    <div class="support-label">Related Tickets:</div>
                    <div class="support-value">
                        <span *ngIf="ticket.related_ticket_id; else noRelated">
                            #{{ ticket.related_ticket_id }}
                        </span>
                        <ng-template #noRelated>-</ng-template>
                    </div>
                </div>
            </div>

            <!-- Third Row: Change Request, Fix Description, Attachment -->
            <div class="support-row third-row">
                <div class="support-item change-request">
                    <div class="support-label">Change Request:</div>
                    <div class="support-value">{{ ticket.change_request || '0' }} Mandays</div>
                </div>

                <!-- Fix Description -->
                <div class="support-item fix-description" *ngIf="ticket.fix_issue_description">
                    <div class="support-label">Fix Description:</div>
                    <div class="support-value">{{ ticket.fix_issue_description }}</div>
                </div>
                <div class="support-item fix-description" *ngIf="!ticket.fix_issue_description">
                    <div class="support-label">Fix Description:</div>
                    <div class="support-value">-</div>
                </div>

                <!-- ✅ Attachment Section - แสดงแบบ Grid เหมือน ticket-detail -->
                <div class="support-item attachment">
                    <div class="support-label">Attachment:</div>
                    
                    <!-- ✅ แสดงเป็น Grid สำหรับรูปภาพและไฟล์ -->
                    <div class="attachment-grid" *ngIf="hasFixAttachments(); else noAttachments">
                        
                        <!-- Attachment Items -->
                        <div *ngFor="let attachment of ticketData!.fix_attachment" 
                             class="attachment-item"
                             (click)="onDownloadAttachment(attachment.attachment_id, attachment.path)"
                             [title]="getAttachmentTooltip(attachment)">

                            <!-- Loading State -->
                            <div class="attachment-loading" 
                                 *ngIf="getFileInfo(attachment.attachment_id).isLoading">
                                <i class="bi bi-hourglass-split"></i>
                                <div class="loading-text">Analyzing...</div>
                            </div>

                            <!-- Image Preview -->
                            <div class="attachment-preview"
                                 *ngIf="isImageFile(attachment.path, attachment.attachment_id) && 
                                        !getFileInfo(attachment.attachment_id).isLoading">
                                <img [src]="attachment.path" 
                                     [alt]="getDisplayFileName(attachment.path, attachment.attachment_id)"
                                     (error)="onImageError(attachment.attachment_id)"
                                     (load)="onImageLoad(attachment.attachment_id)"
                                     loading="lazy"
                                     style="max-width: 100%; max-height: 200px; object-fit: cover; border-radius: 4px;">

                                <div class="file-info-overlay">
                                    <div class="file-name-small">
                                        {{ getDisplayFileName(attachment.path, attachment.attachment_id) }}
                                    </div>
                                    <div class="file-size" *ngIf="getFileSize(attachment)">
                                        {{ getFileSize(attachment) }}
                                    </div>
                                </div>
                            </div>

                            <!-- File Icon Display -->
                            <div class="attachment-file"
                                 *ngIf="!isImageFile(attachment.path, attachment.attachment_id) && 
                                        !getFileInfo(attachment.attachment_id).isLoading">

                                <div class="file-icon-container">
                                    <i [class]="getAttachmentIcon(attachment.path, attachment.file_type)"
                                       [ngClass]="'file-icon-' + getFileInfo(attachment.attachment_id).type"></i>
                                </div>

                                <div class="file-details">
                                    <div class="file-name" 
                                         [title]="getDisplayFileName(attachment.path, attachment.attachment_id)">
                                        {{ getDisplayFileName(attachment.path, attachment.attachment_id) }}
                                    </div>

                                    <div class="file-meta">
                                        <span class="file-type">
                                            {{ getFileInfo(attachment.attachment_id).type.toUpperCase() }}
                                        </span>
                                        <span class="file-size" *ngIf="getFileSize(attachment)">
                                            {{ getFileSize(attachment) }}
                                        </span>
                                    </div>
                                </div>

                                <div class="download-indicator">
                                    <i class="bi bi-download"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- No attachments -->
                    <ng-template #noAttachments>
                        <div class="no-attachments">
                            <i class="bi bi-paperclip"></i>
                            <span class="text-muted">No fix attachments</span>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>

        <!-- No Data State -->
        <div class="no-data-state" *ngIf="!ticketData?.ticket">
            <i class="bi bi-info-circle"></i>
            <p>ไม่มีข้อมูล Support Information</p>
            <small>กำลังโหลดข้อมูล ticket...</small>
        </div>
    </div>
</div>